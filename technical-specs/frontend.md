# Техническое задание: Frontend TestOps Copilot

## 1. Общие положения

### 1.1. Назначение
Разработка клиентской части веб-приложения "TestOps Copilot" - SPA интерфейса для взаимодействия с AI ассистентом автоматизации QA-процессов.

### 1.2. Целевые пользователи
- Manual QA Engineers
- Automation QA Engineers
- QA Leads

### 1.3. Технические требования
- React 18+ с TypeScript
- Сборщик Vite
- Стилизация TailwindCSS + headless UI
- State management: Zustand
- Data fetching: React Query (TanStack Query)
- Редактор кода: Monaco Editor

## 2. Архитектура

### 2.1. Структура приложения
```
src/
├── components/          # Переиспользуемые компоненты
│   ├── ui/             # Базовые UI компоненты
│   ├── chat/           # Компоненты чата
│   └── editor/         # Компоненты редактора кода
├── pages/              # Страницы приложения
│   ├── Dashboard/      # Главная страница
│   ├── Chat/           # Чат с ассистентом
│   └── Settings/       # Настройки
├── hooks/              # Кастомные React хуки
├── services/           # API клиенты
├── stores/             # Zustand store
├── types/              # TypeScript типы
├── utils/              # Утилиты
└── styles/             # Глобальные стили
```

### 2.2. Основные компоненты

#### 2.2.1. ChatInterface
- История сообщений
- Поле ввода с поддержкой многострочного текста
- Кнопки отправки и загрузки файлов
- Отображение статуса набора текста

#### 2.2.2. CodeEditor
- Monaco Editor с подсветкой синтаксиса Python
- Нумерация строк
- Темная/светлая тема
- Кнопки копирования, скачивания, форматирования
- Валидация синтаксиса в реальном времени

#### 2.2.3. ResponseDisplay
- Табы для разных типов ответа (код, валидация, дифф)
- Сворачиваемые секции
- Экспорт в файл

## 3. Функциональные требования

### 3.1. Чат с ассистентом
- Отправка текстовых сообщений
- Загрузка файлов (.txt, .py, .yaml, .json, изображения)
- История чата с сохранением в localStorage
- Копирование сообщений
- Регенерация ответа

### 3.2. Редактор кода
- Подсветка синтаксиса Python
- Проверка синтаксиса
- Форматирование кода
- Поиск и замена
- Горячие клавиши

### 3.3. Валидация кода
- Отображение ошибок и предупреждений
- Предложения по исправлению
- Сравнение версий кода (diff)

### 3.4. GitLab интеграция
- Выбор проекта GitLab
- Создание Merge Request
- Просмотр статуса MR

## 4. UI/UX требования

### 4.1. Дизайн
- Современный, минималистичный интерфейс
- Адаптивный дизайн (desktop-first)
- Темная и светлая тема
- Плавные анимации

### 4.2. Интерактивность
- Индикаторы загрузки
- Уведомления об успехе/ошибках
- Подтверждения критических действий
- Горячие клавиши

### 4.3. Доступность
- ARIA метки
- Навигация с клавиатуры
- Контрастность цветов

## 5. Интеграция с бэкендом

### 5.1. API эндпоинты
```typescript
// Генерация ручных тестов
POST /api/v1/generate/manual
Body: { requirements: string, meta?: MetaData }

// Генерация API тестов
POST /api/v1/generate/auto/api
Body: { openapi_spec: string, endpoint?: string }

// Валидация кода
POST /api/v1/analyze/validate
Body: { code_snippet: string }

// Создание MR в GitLab
POST /api/v1/gitlab/mr
Body: { project_id: number, code: string, branch: string }
```

### 5.2. WebSocket соединение
- Стриминг ответов от AI
- Статус обработки запроса
- Прогресс-бар

## 6. Состояния приложения

### 6.1. ChatStore
```typescript
interface ChatState {
  messages: Message[]
  isLoading: boolean
  error: string | null

  // Actions
  sendMessage: (content: string, files?: File[]) => Promise<void>
  regenerateResponse: (messageId: string) => Promise<void>
  clearChat: () => void
}
```

### 6.2. EditorStore
```typescript
interface EditorState {
  code: string
  language: string
  theme: 'light' | 'dark'
  isValid: boolean
  errors: SyntaxError[]

  // Actions
  updateCode: (code: string) => void
  validateCode: () => Promise<void>
  formatCode: () => Promise<void>
}
```

## 7. Производительность

### 7.1. Оптимизации
- Ленивая загрузка компонентов
- Виртуализация длинных списков
- Кэширование API запросов
- Дебаунсинг ввода

### 7.2. Метрики
- Первичная загрузка < 3 секунд
- Время отклика на действие < 500ms
- FPS > 60 при анимациях

## 8. Безопасность

### 8.1. Аутентификация
- JWT токены в httpOnly cookies
- Обновление токена
- Logout при неактивности

### 8.2. Безопасность данных
- Валидация ввода на клиенте
- Sanitизация пользовательского контента
- Защита от XSS

## 9. Тестирование

### 9.1. Unit тесты
- Компонентные тесты с React Testing Library
- Покрытие > 80%
- Тесты хуков и утилит

### 9.2. E2E тесты
- Критические пользовательские пути
- Тесты с Playwright
- CI/CD интеграция

## 10. Сборка и деплой

### 10.1. Сборка
```bash
# Dev сервер
npm run dev

# Production сборка
npm run build

# Preview
npm run preview
```

### 10.2. Docker
- Многостадийный Dockerfile
- Оптимизация размера образа
- Nginx для статики

## 11. Дополнительные требования

### 11.1. Интернационализация
- Поддержка русского и английского
- Форматы дат/чисел

### 11.2. Аналитика
- События пользовательских действий
- Метрики использования
- Ошибки frontend

### 11.3. Документация
- Storybook для компонентов
- Readme для разработки
- Архитектурные решения