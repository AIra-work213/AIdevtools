# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –∫–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è (pipeline) –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UI —Ç–µ—Å—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –∞–Ω—Å–∞–º–±–ª—å –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö LLM –º–æ–¥–µ–ª–µ–π –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞.

## üîÑ –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```mermaid
graph TD
    User[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] -->|URL / HTML| API[Backend API]
    API --> Stage0[Stage 0: –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å–∞–π—Ç–∞]
    Stage0 -->|–ö–æ–Ω—Ç–µ–∫—Å—Ç + –°–µ–ª–µ–∫—Ç–æ—Ä—ã| Stage1[Stage 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è]
    
    subgraph "Stage 1: –ê–Ω—Å–∞–º–±–ª—å –º–æ–¥–µ–ª–µ–π"
        Stage1 -->|–ü—Ä–æ–º–ø—Ç| Model1[Qwen/Qwen3-235B]
        Stage1 -->|–ü—Ä–æ–º–ø—Ç| Model2[openai/gpt-oss-120b]
        Stage1 -->|–ü—Ä–æ–º–ø—Ç| Model3[t-tech/T-pro-it-2.0]
    end
    
    Model1 -->|Code v1| Aggregator
    Model2 -->|Code v2| Aggregator
    Model3 -->|Code v3| Aggregator
    
    subgraph "Stage 1.5: –ê–≥—Ä–µ–≥–∞—Ü–∏—è"
        Aggregator[Qwen –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä] -->|–ê–Ω–∞–ª–∏–∑ –∏ —Å–ª–∏—è–Ω–∏–µ| BestCode[–õ—É—á—à–∏–π –∫–æ–¥]
    end
    
    BestCode --> Stage2[Stage 2: Allure –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è]
    Stage2 -->|–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤| FinalCode[–§–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥]
    
    FinalCode --> Validator[–í–∞–ª–∏–¥–∞—Ç–æ—Ä –∫–æ–¥–∞]
    Validator -->|–£—Å–ø–µ—Ö| DB[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ]
    Validator -->|–û—à–∏–±–∫–∞| Retry[–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è]
    
    DB --> User
```

## üìù –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤

### Stage 0: –ê–Ω–∞–ª–∏–∑ –≤–µ–±-—Å–∞–π—Ç–∞ (Website Analysis)
–ü–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞ —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
*   **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** `aiohttp`, `BeautifulSoup`.
*   **–î–µ–π—Å—Ç–≤–∏—è:**
    *   –ó–∞–≥—Ä—É–∑–∫–∞ HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
    *   –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (`<title>`), –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ (`h1-h3`), –∫–Ω–æ–ø–æ–∫, –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –∏ —Å—Å—ã–ª–æ–∫.
    *   –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ "—Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞" (Actual Page Content Analysis) –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞.
*   **–¶–µ–ª—å:** –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –∏–º —Ñ–∞–∫—Ç—ã –æ —Ä–µ–∞–ª—å–Ω–æ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–º —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

### Stage 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (Parallel Generation)
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ç—Ä–µ–º—è —Ä–∞–∑–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏.
*   **–ú–æ–¥–µ–ª–∏:**
    1.  `Qwen/Qwen3-235B-A22B-Instruct-2507` (–ú–æ—â–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è –ª–æ–≥–∏–∫–∏)
    2.  `openai/gpt-oss-120b` (–•–æ—Ä–æ—à–µ–µ –∑–Ω–∞–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞)
    3.  `t-tech/T-pro-it-2.0` (–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
*   **–ú–µ—Ö–∞–Ω–∏–∑–º:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `asyncio.gather()`.
*   **–ü—Ä–æ–º–ø—Ç:** –°–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä–æ–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é Selenium, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Headless —Ä–µ–∂–∏–º–∞ (Docker-compatible) –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

### Stage 1.5: –ê–≥—Ä–µ–≥–∞—Ü–∏—è (Aggregation)
–ö–ª—é—á–µ–≤–æ–π —ç—Ç–∞–ø –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞.
*   **–ê–≥–µ–Ω—Ç:** `Qwen/Qwen3-235B-A22B-Instruct-2507`.
*   **–ó–∞–¥–∞—á–∞:** –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∫–æ–¥–∞ –∏–∑ Stage 1 –∏ —Å–æ–∑–¥–∞—Ç—å "–ò–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç".
*   **–õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞:**
    *   –í—ã–±–æ—Ä –Ω–∞–∏–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ (ID > data-attributes > CSS > XPath).
    *   –í—ã–±–æ—Ä —Å–∞–º—ã—Ö –ø–æ–ª–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ (Assertions).
    *   –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞.
    *   –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫.

### Stage 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Allure (Allure Wrapping)
–û–±–æ–≥–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏.
*   **–î–µ–π—Å—Ç–≤–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ Allure –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ç–µ—Å—Ç–∞.
*   **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π –≤–∞–∂–Ω–æ—Å—Ç–∏: `allure.severity_level.CRITICAL` / `NORMAL`.
    *   –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `@allure.step` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (–Ω–∞–≤–∏–≥–∞—Ü–∏—è, –∫–ª–∏–∫, –ø—Ä–æ–≤–µ—Ä–∫–∞).
    *   –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (`@allure.feature`, `@allure.story`).

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
*   **Code Validator:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python (AST parsing) –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º –æ—Ç–≤–µ—Ç–∞.
*   **Execution Environment:**
    *   –ó–∞–ø—É—Å–∫ –≤–Ω—É—Ç—Ä–∏ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Xvfb` (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∏—Å–ø–ª–µ–π) –∏–ª–∏ Headless Chrome.
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫ `chromium` –∏ `chromedriver`.

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1.  **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ï—Å–ª–∏ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –æ—à–∏–±–∞–µ—Ç—Å—è –∏–ª–∏ –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä—É–µ—Ç, –¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏ –∏ —ç—Ç–∞–ø –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç —ç—Ç–æ.
2.  **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:** –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏–∑ –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.
3.  **–°–∫–æ—Ä–æ—Å—Ç—å:** –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –º–æ–¥–µ–ª–µ–π –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è (–≤—Ä–µ–º—è —Ä–∞–≤–Ω–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–∞–º–æ–π –º–µ–¥–ª–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ + –≤—Ä–µ–º—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏).
4.  **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ CI/CD:** –¢–µ—Å—Ç—ã —Å—Ä–∞–∑—É –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ CI (Headless, Docker paths) –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å—é Allure.
